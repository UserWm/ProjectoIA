<!-- layout.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creaci√≥n de productos</title>

    <!-- Tipograf√≠a -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root {
            --blue-1: #03045E;
            --blue-2: #0077B6;
            --blue-3: #00B4D8;
            --blue-4: #90E0EF;
            --blue-5: #CAF0F8;
        }

        body {
            font-family: "Poppins", sans-serif;
            background-color: var(--blue-5);
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 300px;
            height: 100vh;
            background: var(--blue-1);
            color: white;
            padding: 30px 20px;
        }

        .sidebar-item {
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: 0.3s;
        }

        .sidebar-item:hover {
            background: var(--blue-3);
        }

        .content {
            margin-left: 320px;
            padding: 30px;
        }

        /* Burbuja tipo ChatGPT */
        #resultado {
            background:white;
            border-radius:14px;
            min-height:120px;
            border:1px solid #90E0EF;
            padding:20px;
            white-space:pre-wrap;
            line-height:1.6;
            font-size:16px;
        }
    </style>

</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="sidebar-item" onclick="window.location.href='../dashboard.html'">
    Dashboard
</div>
<hr>
    <h4 class="fw-bold mb-4">Historial</h4>

    <div id="historial-list"></div>
</div>
</div>

<!-- CONTENIDO DIN√ÅMICO -->
<div class="content">
  <h2 class="fw-bold mb-4" style="color:#03045E;">Creaci√≥n de Textos Publicitarios</h2>

<div class="card shadow-sm p-4" style="border-radius: 18px;">

    <h5 class="fw-bold mb-3" style="color:#03045E;">Filtros avanzados</h5>

    <div class="row g-4">

        <!-- TIPO DE PRODUCTO -->
        <div class="col-md-6">
            <label class="fw-bold mb-1">Tipo de producto</label>
            <select id="select-productos" class="form-select">
                <option value="">Cargando productos...</option>
            </select>
        </div>

        <!-- P√öBLICO: EDAD -->
        <div class="col-md-4">
            <label class="fw-bold mb-1">Edad del p√∫blico</label>
            <select class="form-select filtro">
                <option>18‚Äì25</option>
                <option>25‚Äì35</option>
                <option>35‚Äì50</option>
                <option>50+</option>
            </select>
        </div>

        <!-- P√öBLICO: G√âNERO -->
        <div class="col-md-4">
            <label class="fw-bold mb-1">G√©nero del p√∫blico</label>
            <select class="form-select filtro">
                <option>Mixto</option>
                <option>Masculino</option>
                <option>Femenino</option>
            </select>
        </div>

        <!-- INTERESES -->
        <div class="col-md-4">
            <label class="fw-bold mb-1">Intereses</label>
            <select class="form-select filtro">
                <option>Fitness</option>
                <option>Ahorro</option>
                <option>Tecnolog√≠a</option>
                <option>Emprendimiento</option>
                <option>Moda</option>
                <option>Bienestar personal</option>
                <option>Productividad</option>
            </select>
        </div>

        <!-- OBJETIVO DEL CONTENIDO -->
        <div class="col-md-6">
            <label class="fw-bold mb-1">Objetivo del contenido</label>
            <select class="form-select filtro">
                <option>Aumentar ventas</option>
                <option>Captar leads</option>
                <option>Reconocimiento de marca</option>
                <option>Educar al cliente</option>
                <option>Destacar beneficios</option>
                <option>Promoci√≥n especial</option>
                <option>Lanzamiento de producto</option>
            </select>
        </div>

        <!-- TONO DEL MENSAJE -->
        <div class="col-md-6">
            <label class="fw-bold mb-1">Tono del mensaje</label>
            <select class="form-select filtro">
                <option>Motivacional</option>
                <option>Emocional</option>
                <option>T√©cnico</option>
                <option>Directo a ventas</option>
                <option>Humor√≠stico</option>
                <option>Elegante y premium</option>
                <option>Informativo</option>
                <option>Persuasivo</option>
                <option>Amigable</option>
            </select>
        </div>

        <!-- CANAL DE PUBLICACI√ìN -->
        <div class="col-md-12">
            <label class="fw-bold mb-1">Canal donde se publicar√°</label>
            <select class="form-select filtro">
                <option>Facebook</option>
                <option>Instagram</option>
                <option>TikTok</option>
                <option>WhatsApp Business</option>
                <option>P√°gina web</option>
                <option>Email marketing</option>
                <option>Meta Ads</option>
                <option>Google Ads</option>
            </select>
        </div>

        <!-- DIFERENCIADORES -->
        <div class="col-md-12">
            <label class="fw-bold mb-1">Diferenciadores del producto</label>
            <select class="form-select filtro">
                <option>Natural / Org√°nico</option>
                <option>Alta calidad</option>
                <option>Duraci√≥n prolongada</option>
                <option>Precio competitivo</option>
                <option>Resultados inmediatos</option>
                <option>Innovador</option>
                <option>Premium</option>
            </select>
        </div>

        <!-- NIVEL DE CREATIVIDAD -->
        <div class="col-md-12">
            <label class="fw-bold mb-1">Nivel de creatividad</label>
            <select class="form-select filtro">
                <option>Bajo (formal)</option>
                <option>Medio (equilibrado)</option>
                <option>Alto (creativo / impacto)</option>
            </select>
        </div>

        <!-- DESCRIPCION -->
        <div class="col-12">
            <label class="fw-bold mb-1">Requerimientos adicionales</label>
            <textarea class="form-control" id="descripcion" rows="4" placeholder="Describa brevemente el producto..."></textarea>
        </div>

    </div>

    <hr class="my-4">

    <button id="btn-generar" class="btn px-4 py-2 text-white fw-semibold" style="background:#0077B6;border:none;">
        Generar contenido
    </button>

    <!-- CONTENEDOR DEL RESULTADO -->
    <div id="resultado" class="mt-4" style="display:none;"></div>
 <button id="btn-copiar" 
        class="btn mt-3 fw-semibold" 
        style="background:#90E0EF;color:#03045E;border:none;display:none;">
    Copiar texto
</button>

</div>


</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ========================= -->
<!--     CARGA DE PRODUCTOS    -->
<!-- ========================= -->
<script type="module">
document.addEventListener("DOMContentLoaded", async () => {
    const selectProductos = document.getElementById("select-productos");

    try {
        const res = await fetch("http://localhost:4000/api/productos");
        const data = await res.json();

        selectProductos.innerHTML = `<option value="">Seleccione un producto...</option>`;

        data.forEach(prod => {
            selectProductos.innerHTML += `
                <option value="${prod._id}">
                    ${prod.nombre}
                </option>
            `;
        });

    } catch (error) {
        selectProductos.innerHTML = `<option value="">Error al cargar productos</option>`;
        console.error("Error cargando productos:", error);
    }
});
</script>

<!-- ========================= -->
<!--  GENERAR TEXTO CON IA     -->
<!-- ========================= -->
<script type="module">
document.addEventListener("DOMContentLoaded", () => {

    const btn = document.getElementById("btn-generar");
    const resultado = document.getElementById("resultado");

    btn.addEventListener("click", async () => {

        const filtros = {
            producto: document.getElementById("select-productos").options[
                document.getElementById("select-productos").selectedIndex
            ].text,
            edad: document.querySelectorAll(".filtro")[0].value,
            genero: document.querySelectorAll(".filtro")[1].value,
            intereses: document.querySelectorAll(".filtro")[2].value,
            objetivo: document.querySelectorAll(".filtro")[3].value,
            tono: document.querySelectorAll(".filtro")[4].value,
            canal: document.querySelectorAll(".filtro")[5].value,
            diferenciador: document.querySelectorAll(".filtro")[6].value,
            creatividad: document.querySelectorAll(".filtro")[7].value,
            descripcion: document.getElementById("descripcion").value
        };

        resultado.style.display = "block";
        resultado.innerHTML = `<em style="color:#0077B6;">Generando contenido...</em>`;

        try {
            const res = await fetch("http://localhost:4000/api/crear-texto", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(filtros)
            });

            const data = await res.json();
            const texto = data.resultado;

            resultado.innerHTML = "";
            let i = 0;

            function escribir() {
                if (i < texto.length) {
                    resultado.innerHTML += texto.charAt(i);
                    i++;
                    setTimeout(escribir, 12);
                }
            }

            escribir();

        } catch (err) {
            resultado.innerHTML = `<span style="color:red;">Error al generar contenido</span>`;
            console.error(err);
        }
    });

});


document.addEventListener("DOMContentLoaded", () => {
    
    const btnCopiar = document.getElementById("btn-copiar");
    const resultado = document.getElementById("resultado");

    // Mostrar el bot√≥n cuando haya texto escrito
    const observer = new MutationObserver(() => {
        if (resultado.innerText.trim().length > 0) {
            btnCopiar.style.display = "inline-block";
        }
    });

    observer.observe(resultado, { childList: true, subtree: true });

    // Acci√≥n para copiar
    btnCopiar.addEventListener("click", async () => {
        try {
            await navigator.clipboard.writeText(resultado.innerText.trim());
            btnCopiar.innerHTML = "Copiado ‚úî";

            // Restablecer el bot√≥n despu√©s de 2s
            setTimeout(() => {
                btnCopiar.innerHTML = "Copiar texto";
            }, 2000);

        } catch (err) {
            console.error("Error al copiar:", err);
        }
    });

});


</script>

<script type="module">
document.addEventListener("DOMContentLoaded", async () => {
    const contenedorHistorial = document.getElementById("historial-list");
    const resultado = document.getElementById("resultado");

    try {
        // Obtener historial desde backend
        const res = await fetch("http://localhost:4000/api/historial-texto");
        const historial = await res.json();

        if (!historial.length) {
            contenedorHistorial.innerHTML = "<p class='text-white-50'>Sin historial</p>";
            return;
        }

        historial.forEach(item => {
            const resumen = item.busqueda.slice(0, 35) + "...";

            const div = document.createElement("div");
            div.classList.add("sidebar-item");
            div.innerHTML = `
                <div><strong>Texto Publicitario</strong></div>
                <small>${resumen}</small>
            `;

            // üî• Al darle clic mostrar el resultado en el mismo contenedor
            div.addEventListener("click", () => {
                resultado.style.display = "block";
                resultado.innerHTML = item.resultado;
            });

            contenedorHistorial.appendChild(div);
        });

    } catch (error) {
        contenedorHistorial.innerHTML = "<p class='text-white-50'>Error al cargar historial</p>";
        console.error(error);
    }
});
</script>


</body>
</html>
