<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Eslóganes</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            font-family: Poppins, sans-serif;
            background:#CAF0F8;
        }
        .sidebar {
            position: fixed;
            left:0;
            top:0;
            width:300px;
            height:100vh;
            background:#03045E;
            color:white;
            padding:25px;
            overflow-y:auto;
        }
        .sidebar-item {
            padding:10px 15px;
            background:rgba(255,255,255,0.1);
            border-radius:8px;
            margin-bottom:10px;
            cursor:pointer;
            transition:0.2s;
        }
        .sidebar-item:hover {
            background:#0077B6;
        }
        .content {
            margin-left:330px;
            padding:30px;
        }
        #resultado {
            background:white;
            border-radius:14px;
            min-height:100px;
            border:1px solid #90E0EF;
            padding:20px;
            white-space:pre-wrap;
            line-height:1.6;
        }
    </style>
</head>

<body>

<!-- ============================ SIDEBAR =============================== -->
<div class="sidebar">

    <div class="sidebar-item" onclick="window.location.href='../dashboard.html'">
        Dashboard
    </div>

    <hr>

    <h2 class="fw-bold mb-4">Historial</h2>
    <div id="historial-list"></div>

</div>

<!-- ============================ CONTENIDO =============================== -->
<div class="content">

    <h2 class="fw-bold mb-4" style="color:#03045E;">Generador de Eslóganes Breves</h2>

    <div class="card p-4 shadow-sm" style="border-radius:18px">

        <div class="row g-4">

            <!-- PRODUCTO -->
            <div class="col-md-6">
                <label class="fw-bold mb-1">Producto</label>
                <select id="select-productos" class="form-select">
                    <option value="">Cargando...</option>
                </select>
            </div>

            <!-- TIPO DE ESLÓGAN -->
            <div class="col-md-6">
                <label class="fw-bold mb-1">Tipo de Eslógan</label>
                <select id="tipo-eslogan" class="form-select">
                    <option>Inspirador</option>
                    <option>Persuasivo</option>
                    <option>Corto y directo</option>
                    <option>Premium</option>
                    <option>Emocional</option>
                    <option>Divertido</option>
                </select>
            </div>

            <!-- EDAD -->
            <div class="col-md-4">
                <label class="fw-bold mb-1">Edad objetivo</label>
                <select id="edad" class="form-select">
                    <option>18–25</option>
                    <option>25–35</option>
                    <option>35–50</option>
                    <option>50+</option>
                </select>
            </div>

            <!-- GÉNERO -->
            <div class="col-md-4">
                <label class="fw-bold mb-1">Género</label>
                <select id="genero" class="form-select">
                    <option>Mixto</option>
                    <option>Masculino</option>
                    <option>Femenino</option>
                </select>
            </div>

            <!-- INTERESES -->
            <div class="col-md-4">
                <label class="fw-bold mb-1">Intereses</label>
                <select id="intereses" class="form-select">
                    <option>Salud</option>
                    <option>Tecnología</option>
                    <option>Bienestar</option>
                    <option>Fitness</option>
                    <option>Ahorro</option>
                    <option>Moda</option>
                </select>
            </div>

            <!-- OBJETIVO -->
            <div class="col-md-12">
                <label class="fw-bold mb-1">Objetivo del eslógan</label>
                <select id="objetivo" class="form-select">
                    <option>Aumentar ventas</option>
                    <option>Posicionamiento</option>
                    <option>Recordación de marca</option>
                    <option>Lanzamiento de producto</option>
                </select>
            </div>

            <!-- DESCRIPCIÓN -->
            <div class="col-12">
                <label class="fw-bold mb-1">Descripción adicional</label>
                <textarea id="descripcion" rows="4" class="form-control"></textarea>
            </div>

        </div>

        <hr>

        <!-- BOTÓN GENERAR -->
        <button id="btn-generar" class="btn text-white" style="background:#0077B6">
            Generar Eslógan Breve
        </button>

        <!-- RESULTADO -->
        <div id="resultado" class="mt-4" style="display:none;"></div>

        <!-- COPIAR -->
        <button id="btn-copiar" class="btn mt-3" 
            style="background:#90E0EF;display:none;color:#03045E;border:none">
        Copiar texto</button>

    </div>

</div>

<!-- ============================ SCRIPTS =============================== -->

<!-- CARGAR PRODUCTOS -->
<script type="module">
document.addEventListener("DOMContentLoaded", async () => {
    const select = document.getElementById("select-productos");

    const res = await fetch("http://localhost:4000/api/productos");
    const productos = await res.json();

    select.innerHTML = "<option value=''>Seleccione...</option>";
    productos.forEach(p => {
        select.innerHTML += `<option value="${p.nombre}">${p.nombre}</option>`;
    });
});
</script>

<!-- GENERAR ESLÓGAN -->
<script type="module">
document.getElementById("btn-generar").addEventListener("click", async () => {

    const filtros = {
        producto: document.getElementById("select-productos").value,
        tipo: document.getElementById("tipo-eslogan").value,
        edad: document.getElementById("edad").value,
        genero: document.getElementById("genero").value,
        intereses: document.getElementById("intereses").value,
        objetivo: document.getElementById("objetivo").value,
        descripcion: document.getElementById("descripcion").value
    };

    const cont = document.getElementById("resultado");
    cont.style.display = "block";
    cont.innerHTML = "Generando eslógan breve...";

    const res = await fetch("http://localhost:4000/api/esloganes", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(filtros)
    });

    const data = await res.json();
    let texto = data.resultado;

    cont.innerHTML = "";
    let i = 0;
    
    (function escribir(){
        if(i < texto.length){
            cont.innerHTML += texto.charAt(i);
            i++;
            setTimeout(escribir, 15);
        }
    })();

    document.getElementById("btn-copiar").style.display = "inline-block";
});
</script>

<!-- COPIAR -->
<script type="module">
document.getElementById("btn-copiar").addEventListener("click", async () => {
    const texto = document.getElementById("resultado").innerText;
    await navigator.clipboard.writeText(texto);
    const btn = document.getElementById("btn-copiar");
    btn.innerHTML = "Copiado ✔";
    setTimeout(() => btn.innerHTML = "Copiar texto", 2000);
});
</script>

<!-- HISTORIAL -->
<script type="module">
document.addEventListener("DOMContentLoaded", async () => {
    const cont = document.getElementById("historial-list");
    const resultado = document.getElementById("resultado");

    const res = await fetch("http://localhost:4000/api/esloganes");
    const historial = await res.json();

    if (!historial.length) {
        cont.innerHTML = "<p class='text-white-50'>Sin historial</p>";
        return;
    }

    historial.forEach(item => {
        const resumen = JSON.stringify(item.busqueda).slice(0,40) + "...";

        const div = document.createElement("div");
        div.className = "sidebar-item";
        div.innerHTML = `<strong>Eslógan</strong><br><small>${resumen}</small>`;

        div.addEventListener("click", () => {
            resultado.style.display = "block";
            resultado.innerText = item.resultado;
        });

        cont.appendChild(div);
    });
});
</script>

</body>
</html>
